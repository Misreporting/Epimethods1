{
  "hash": "a5359a9b4a5b208c05526ae680da3064",
  "result": {
    "markdown": "# Example data analysis in YRBS\n\n## Summary of statistical methods\n\nRecall the table from chapter 1 for summarizing data from categorical (C) and quantitative (Q) variables. The types of analysis depend on the types of data.\n\nWe divide data into categorical (C) and quantitative (Q). The types of analysis depend on the types of data.\n\nCategorical variables can further be categorized as ordinal or non-ordinal.\n\n| Variable type          | Outcome Quantitative | Outcome Categorical |\n|:-----------------------|:---------------------|:--------------------|\n| Predictor quantitative | $Q \\rightarrow Q$    | $Q \\rightarrow C$   |\n| Predictor categorical  | $C \\rightarrow Q$    | $C \\rightarrow C$   |\n\nThe displays and analysis types are not meant to correspond to each other.\n\nThis table is not meant to be a cookbook. This table demonstrates that some types of analysis definitely do not make sense for some types of data. E.g., scatterplot cannot be used instead of 2x2 table.\n\n| Data                                   | Display                                | Analysis                                    |\n|:------------------|:---------------------------------|:------------------|\n| $Q \\rightarrow Q$                      | scatterplots (xyplot)                  | linear regression (lm)                      |\n| $Q \\rightarrow C$ or $C \\rightarrow Q$ | Box and whisker plot (bwplot)          |                                             |\n|                                        | dotplot (w or w/o confidence interval) |                                             |\n| Categorical variable is binary         | stratified density plot (densityplot)  | t-test, Wilcoxon                            |\n| Categorical variable is binary         |                                        | Logistic regression glm( , family=binomial) |\n| Categorical variable is not binary     |                                        | test for trend (if ordinal): e.g., Cuzick's |\n| Categorical variable is not binary     |                                        | Tukey's HSD (anova followesd by TukeyHSD)   |\n| Categorical variable is not binary     |                                        | transform to binary and use above methods   |\n| $C \\rightarrow C$                      | Contingency table (tally)              | chi-square test (chisq.test)                |\n|                                        |                                        | Kruskal-Wallis test (kruskal.test)          |\n|                                        |                                        | pairwise chi-square test                    |\n\n\n\n## Logistic regression\nThe regression type that you use is determined by your outcome variable, not by your predictors. Many outcome variables are binary/dichotomous: that is, they take only the values 0 or 1 (or FALSE and TRUE). You can model binary outcome variables with four different methods: logistic regression, Poisson regression, ordinary linear regression, and probit regression. Logistic\nregression is most commonly used in public health.\n\nThe coefficients in a logistic regression are log odds ratios; many statistical programs will\ntransform them automatically for you. The predicted values from a logistic regression are the\nestimated probabilities of the event occurring.\n\n### Variable selection and coding for data analysis\nThere are many guidelines for identifying covariates for data analysis. Here are some ideas:\n• Important demographic features: socioeconomic status, race/ethnicity, gender, age. These may be important to control for, even if non-significant.\n• Variables predicted to be potential confounders by relevant theories: e.g., health behavior theories often include a construct relevant to self-efficacy to carry out a health behavior.\n• Variables used as control variables in other papers can suggest both which theories are important and empirically which variables are important.\n\n### Examples of logistic regression in YRBS\nWe start out by defining necessary variables. I rename everything so that I can read the output more easily. I also change factors to a scale that makes sense. For all varaibles, consult the codebook. Each variable is listed at least twice: first, to show the wording of the question and the answer choices followed by a dichotomized version (if applicable); second, to show the distribution of the variable (how many respondents gave each answer) and the coding (e.g., 1 = yes and 2 = no).\nFor creating new variable:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Setting new variable to be true if old variable is 1 and 0 otherwise\nyrbs$newvariable=yrbs$oldvariable==1\n# check it did what you expected tally(newvariable ~ oldvariable, data=yrbs)\n```\n:::\n\n\n\nLoad necessary libraries and data. We are using a new library here called arm because it displays regression analysis results compactly. Check data has expected number of variables (columns) and observations (rows).\n\nWe use the Stata format because it reliably keeps the labels.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readstata13)\nlibrary(mosaic)\nlibrary(arm)\nyrbs=read.dta13(\"yrbs2019.dta\")\ndim(yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 13677   235\n```\n:::\n:::\n\n\n\nAge is originally on a scale from 1 to 7, but I express it as the actual age in years.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntally(~Q1, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nQ1\n12 years old or younger            13 years old            14 years old \n                     60                      27                    1699 \n           15 years old            16 years old            17 years old \n                   3473                    3628                    3102 \n  18 years old or older                    <NA> \n                   1616                      72 \n```\n:::\n\n```{.r .cell-code}\nyrbs$age = as.numeric(yrbs$Q1)+11\ntally(Q1~age, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                         age\nQ1                          12   13   14   15   16   17   18 <NA>\n  12 years old or younger   60    0    0    0    0    0    0    0\n  13 years old               0   27    0    0    0    0    0    0\n  14 years old               0    0 1699    0    0    0    0    0\n  15 years old               0    0    0 3473    0    0    0    0\n  16 years old               0    0    0    0 3628    0    0    0\n  17 years old               0    0    0    0    0 3102    0    0\n  18 years old or older      0    0    0    0    0    0 1616    0\n  <NA>                       0    0    0    0    0    0    0   72\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$female= yrbs$Q2==\"Female\"\ntally(Q2~female, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        female\nQ2       TRUE FALSE <NA>\n  Female 6885     0    0\n  Male      0  6641    0\n  <NA>      0     0  151\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define race/ethnicity categories\nyrbs$black=yrbs$raceeth==\"black or african american\"\ntally(black ~ raceeth, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       raceeth\nblack   Am Indian/Alaska Native Asian Black or African American\n  TRUE                        0     0                         0\n  FALSE                     145   618                      2040\n  <NA>                        0     0                         0\n       raceeth\nblack   Native Hawaiian/Other PI White Hispanic / Latino Multiple - Hispanic\n  TRUE                         0     0                 0                   0\n  FALSE                       69  6668              1009                2029\n  <NA>                         0     0                 0                   0\n       raceeth\nblack   Multiple - Non-Hispanic <NA>\n  TRUE                        0    0\n  FALSE                     661    0\n  <NA>                        0  438\n```\n:::\n\n```{.r .cell-code}\nyrbs$hispanic=(yrbs$raceeth==\"hispanic / latino\" | yrbs$raceeth==\"multiple - hispanic\")\ntally(hispanic ~ raceeth, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        raceeth\nhispanic Am Indian/Alaska Native Asian Black or African American\n   TRUE                        0     0                         0\n   FALSE                     145   618                      2040\n   <NA>                        0     0                         0\n        raceeth\nhispanic Native Hawaiian/Other PI White Hispanic / Latino Multiple - Hispanic\n   TRUE                         0     0                 0                   0\n   FALSE                       69  6668              1009                2029\n   <NA>                         0     0                 0                   0\n        raceeth\nhispanic Multiple - Non-Hispanic <NA>\n   TRUE                        0    0\n   FALSE                     661    0\n   <NA>                        0  438\n```\n:::\n\n```{.r .cell-code}\nyrbs$white=yrbs$raceeth==\"white\"\nyrbs$asian=yrbs$raceeth==\"asian\"\nyrbs$multi.nonhispanic=yrbs$raceeth==\"multiple - non-hispanic\"\n```\n:::\n\n\nGrade in school. Set grade to missing if grade is 13.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$grade=as.numeric(yrbs$Q3)+8\nis.na(yrbs$grade)=yrbs$grade==13\ntally(~grade, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ngrade\n   9   10   11   12 <NA> \n3637 3717 3322 2850  151 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$age.for.grade=yrbs$age-yrbs$grade\ntally(~age.for.grade, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nage.for.grade\n   0    1    2    3    4    5    6    7    8    9 <NA> \n   7   14   16   34   93 6269 6572  472   30    4  166 \n```\n:::\n\n```{.r .cell-code}\nyrbs$appropriate.age.for.grade=yrbs$age.for.grade<=6\ntally(appropriate.age.for.grade ~age.for.grade, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                         age.for.grade\nappropriate.age.for.grade    0    1    2    3    4    5    6    7    8    9\n                    TRUE     7   14   16   34   93 6269 6572    0    0    0\n                    FALSE    0    0    0    0    0    0    0  472   30    4\n                    <NA>     0    0    0    0    0    0    0    0    0    0\n                         age.for.grade\nappropriate.age.for.grade <NA>\n                    TRUE     0\n                    FALSE    0\n                    <NA>   166\n```\n:::\n:::\n\n\nWearing a seatbelt never/rarely\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$rarely.seatbelt=yrbs$QN8==1\ntally(rarely.seatbelt ~ Q8 , data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Q8\nrarely.seatbelt Never Rarely Sometimes Most of the time Always <NA>\n          TRUE    294    495         0                0      0    0\n          FALSE     0      0      1064             2999   6297    0\n          <NA>      0      0         0                0      0 2528\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$msm = (yrbs$Q65==\"Males\" & yrbs$female==0)\nyrbs$wsw = (yrbs$Q65==\"Females\" & yrbs$female==1)\nyrbs$same.sex.only= ( yrbs$msm | yrbs$wsw )\nyrbs$same.sex= ( yrbs$same.sex.only | yrbs$Q65==\"Females and males\")\ntally(same.sex ~ Q65, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        Q65\nsame.sex Never had sexual contact Females Males Females and males <NA>\n   TRUE                         0     193    99               543    0\n   FALSE                     4988    2642  2214                 0    0\n   <NA>                         0      30    17                 0 2951\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$glb=yrbs$Q66==\"Gay or lesbian\" | yrbs$Q66==\"Bisexual\"\ntally(glb ~ Q66, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       Q66\nglb     Heterosexual (straight) Gay or lesbian Bisexual Not sure  <NA>\n  TRUE                        0            380     1151        0     0\n  FALSE                   10853              0        0      591     0\n  <NA>                        0              0        0        0   702\n```\n:::\n:::\n\nWe also think that sexual orientation could be related. Define variables for which sex respondents have had sex with (MSM = males who have sex with males, WSW = women who have sex with women), and their sexual orientation. Note that MSM/WSW variables are associated with the predictor of number of sexual partners, so it’s problematic to use them as covariates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$glbq=yrbs$Q66==\"Gay or lesbian\" | yrbs$Q66==\"Bisexual\" | yrbs$Q66==\"Not sure\"\ntally(glbq ~ Q66, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       Q66\nglbq    Heterosexual (straight) Gay or lesbian Bisexual Not sure  <NA>\n  TRUE                        0            380     1151      591     0\n  FALSE                   10853              0        0        0     0\n  <NA>                        0              0        0        0   702\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$any.sports.team=yrbs$QN82==1\ntally(any.sports.team ~ Q82, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Q82\nany.sports.team 0 teams 1 team 2 teams 3 or more teams <NA>\n          TRUE        0   2584    1737            1224    0\n          FALSE    4242      0       0               0    0\n          <NA>        0      0       0               0 3890\n```\n:::\n:::\n\n\n\n## Strength training and sexual partners\nStrength training and number of sexual partners\nOur main predictor and outcome variables are number of sexual partners and days of strength training.\n\n### Define variables\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$num.partners=as.numeric(yrbs$Q60) - 1\ntally(num.partners ~ Q60, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Q60\nnum.partners Never had sex 1 person 2 people 3 people 4 people 5 people\n        0             7435        0        0        0        0        0\n        1                0     2043        0        0        0        0\n        2                0        0      926        0        0        0\n        3                0        0        0      563        0        0\n        4                0        0        0        0      294        0\n        5                0        0        0        0        0      197\n        6                0        0        0        0        0        0\n        <NA>             0        0        0        0        0        0\n            Q60\nnum.partners 6 or more people <NA>\n        0                   0    0\n        1                   0    0\n        2                   0    0\n        3                   0    0\n        4                   0    0\n        5                   0    0\n        6                 501    0\n        <NA>                0 1718\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$days.strength.training=as.numeric(yrbs$Q95) - 1\ntally(Q95~days.strength.training, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        days.strength.training\nQ95         0    1    2    3    4    5    6    7 <NA>\n  0 days 2568    0    0    0    0    0    0    0    0\n  1 day     0  812    0    0    0    0    0    0    0\n  2 days    0    0  973    0    0    0    0    0    0\n  3 days    0    0    0 1067    0    0    0    0    0\n  4 days    0    0    0    0  763    0    0    0    0\n  5 days    0    0    0    0    0  877    0    0    0\n  6 days    0    0    0    0    0    0  361    0    0\n  7 days    0    0    0    0    0    0    0 1053    0\n  <NA>      0    0    0    0    0    0    0    0 5203\n```\n:::\n\n```{.r .cell-code}\nyrbs$any.strength.training=yrbs$days.strength.training >= 1\ntally(Q95~any.strength.training, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        any.strength.training\nQ95      TRUE FALSE <NA>\n  0 days    0  2568    0\n  1 day   812     0    0\n  2 days  973     0    0\n  3 days 1067     0    0\n  4 days  763     0    0\n  5 days  877     0    0\n  6 days  361     0    0\n  7 days 1053     0    0\n  <NA>      0     0 5203\n```\n:::\n:::\n\n\n\n### Crude odds ratio\n\n\n\nEvaluate whether strength training is associated with number of sexual partners. The first model estimates the crude odds ratio and its p-value. The second model estimates the adjusted odds ratio, adjusting for age, gender, and sports team participation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel0=glm(any.strength.training ~ num.partners, family=\"binomial\", data=yrbs)\ncbind(exp(coef(model0)), exp(confint(model0)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                         2.5 %   97.5 %\n(Intercept)  2.325748 2.197629 2.462291\nnum.partners 1.023808 0.991453 1.057742\n```\n:::\n:::\n\n\n### Adjusted odds ratio\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1=glm(any.strength.training ~ num.partners + age + female + any.sports.team + any.sports.team*female + glb + glb*female , family=\"binomial\", data=yrbs)\ndisplay(model1, detail=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nglm(formula = any.strength.training ~ num.partners + age + female + \n    any.sports.team + any.sports.team * female + glb + glb * \n    female, family = \"binomial\", data = yrbs)\n                               coef.est coef.se z value Pr(>|z|)\n(Intercept)                     1.93     0.37    5.19    0.00   \nnum.partners                    0.03     0.02    1.72    0.08   \nage                            -0.09     0.02   -3.92    0.00   \nfemaleTRUE                     -0.40     0.08   -5.19    0.00   \nany.sports.teamTRUE             1.38     0.08   16.40    0.00   \nglbTRUE                        -0.62     0.16   -3.77    0.00   \nfemaleTRUE:any.sports.teamTRUE -0.38     0.11   -3.44    0.00   \nfemaleTRUE:glbTRUE              0.34     0.19    1.80    0.07   \n---\n  n = 7433, k = 8\n  residual deviance = 8312.0, null deviance = 9031.6 (difference = 719.6)\n```\n:::\n\n```{.r .cell-code}\ncbind(exp(coef(model1)),exp(confint(model1)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                                             2.5 %     97.5 %\n(Intercept)                    6.9165709 3.3364304 14.3661158\nnum.partners                   1.0324601 0.9958725  1.0709013\nage                            0.9139132 0.8736332  0.9559790\nfemaleTRUE                     0.6683446 0.5738147  0.7780850\nany.sports.teamTRUE            3.9775010 3.3752060  4.6951738\nglbTRUE                        0.5400348 0.3925578  0.7459683\nfemaleTRUE:any.sports.teamTRUE 0.6859657 0.5531117  0.8501359\nfemaleTRUE:glbTRUE             1.4015063 0.9693141  2.0204604\n```\n:::\n:::\n\n\n\nThe crude odds ratio and 95% confidence interval for the association between number of sexual partners and engaging in any strength training is 1.03 (1.01, 1.06), and the adjusted odds ratio is 1.04 (1.01, 1.07), adjusting for age, sex, sexual orientation, and sports team participation. We can regard the coefficients on these control variables as nuisance parameters.\nWe can evaluate for effect modification by gender for both our main effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel2=glm(any.strength.training ~ num.partners + age + female + any.sports.team + any.sports.team*female + glb + glb*female + num.partners*female, family=\"binomial\", data=yrbs)\ndisplay(model2, detail=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nglm(formula = any.strength.training ~ num.partners + age + female + \n    any.sports.team + any.sports.team * female + glb + glb * \n    female + num.partners * female, family = \"binomial\", data = yrbs)\n                               coef.est coef.se z value Pr(>|z|)\n(Intercept)                     1.82     0.37    4.85    0.00   \nnum.partners                    0.09     0.03    3.46    0.00   \nage                            -0.09     0.02   -3.73    0.00   \nfemaleTRUE                     -0.31     0.08   -3.67    0.00   \nany.sports.teamTRUE             1.37     0.08   16.29    0.00   \nglbTRUE                        -0.63     0.16   -3.85    0.00   \nfemaleTRUE:any.sports.teamTRUE -0.37     0.11   -3.40    0.00   \nfemaleTRUE:glbTRUE              0.37     0.19    1.99    0.05   \nnum.partners:femaleTRUE        -0.12     0.04   -3.29    0.00   \n---\n  n = 7433, k = 9\n  residual deviance = 8301.0, null deviance = 9031.6 (difference = 730.6)\n```\n:::\n\n```{.r .cell-code}\ncbind(exp(coef(model2)),exp(confint(model2)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                                             2.5 %     97.5 %\n(Intercept)                    6.1572718 2.9583529 12.8375392\nnum.partners                   1.0971433 1.0417864  1.1573405\nage                            0.9175708 0.8770303  0.9599216\nfemaleTRUE                     0.7369965 0.6261359  0.8671537\nany.sports.teamTRUE            3.9458993 3.3478580  4.6585373\nglbTRUE                        0.5322496 0.3865827  0.7357501\nfemaleTRUE:any.sports.teamTRUE 0.6890158 0.5555495  0.8539527\nfemaleTRUE:glbTRUE             1.4537884 1.0042945  2.0984839\nnum.partners:femaleTRUE        0.8873172 0.8260548  0.9524688\n```\n:::\n:::\n\n\n\n\nThere is much effect modification, so we may prefer to create separate models for males and females.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel2f=glm(any.strength.training ~ num.partners + age\n+ any.sports.team + glb , family=\"binomial\", data=yrbs, subset=female==1)\ndisplay(model2f, detail=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nglm(formula = any.strength.training ~ num.partners + age + any.sports.team + \n    glb, family = \"binomial\", data = yrbs, subset = female == \n    1)\n                    coef.est coef.se z value Pr(>|z|)\n(Intercept)          1.52     0.49    3.12    0.00   \nnum.partners        -0.03     0.03   -1.02    0.31   \nage                 -0.09     0.03   -2.84    0.00   \nany.sports.teamTRUE  1.00     0.07   14.18    0.00   \nglbTRUE             -0.26     0.09   -2.80    0.01   \n---\n  n = 3839, k = 5\n  residual deviance = 4743.0, null deviance = 4998.2 (difference = 255.2)\n```\n:::\n\n```{.r .cell-code}\ncbind(exp(coef(model2f)),exp(confint(model2f)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                                  2.5 %     97.5 %\n(Intercept)         4.5913847 1.7612809 11.9864705\nnum.partners        0.9737004 0.9254261  1.0248685\nage                 0.9168951 0.8635863  0.9734297\nany.sports.teamTRUE 2.7183719 2.3681710  3.1225726\nglbTRUE             0.7737496 0.6467414  0.9265395\n```\n:::\n\n```{.r .cell-code}\nmodel2m=glm(any.strength.training ~ num.partners + age + any.sports.team + glb , family=\"binomial\", data=yrbs, subset=female==0)\ndisplay(model2m, detail=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nglm(formula = any.strength.training ~ num.partners + age + any.sports.team + \n    glb, family = \"binomial\", data = yrbs, subset = female == \n    0)\n                    coef.est coef.se z value Pr(>|z|)\n(Intercept)          1.80     0.57    3.18    0.00   \nnum.partners         0.09     0.03    3.40    0.00   \nage                 -0.09     0.04   -2.42    0.02   \nany.sports.teamTRUE  1.37     0.08   16.28    0.00   \nglbTRUE             -0.63     0.16   -3.85    0.00   \n---\n  n = 3594, k = 5\n  residual deviance = 3558.1, null deviance = 3896.5 (difference = 338.4)\n```\n:::\n\n```{.r .cell-code}\ncbind(exp(coef(model2m)), exp(confint(model2m)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                                  2.5 %     97.5 %\n(Intercept)         6.0619916 2.0041506 18.4343083\nnum.partners        1.0969474 1.0407212  1.1581297\nage                 0.9184637 0.8573032  0.9837506\nany.sports.teamTRUE 3.9464675 3.3477291  4.6600102\nglbTRUE             0.5322545 0.3865890  0.7357508\n```\n:::\n\n```{.r .cell-code}\nmodel1=glm(num.partners ~ days.strength.training + female + age + any.sports.team + glb, data=yrbs, family=poisson)\nsummary(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = num.partners ~ days.strength.training + female + \n    age + any.sports.team + glb, family = poisson, data = yrbs)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.5304  -1.2333  -0.9343   0.3355   5.7570  \n\nCoefficients:\n                        Estimate Std. Error z value Pr(>|z|)    \n(Intercept)            -6.739015   0.180510 -37.333  < 2e-16 ***\ndays.strength.training  0.045405   0.005272   8.613  < 2e-16 ***\nfemaleTRUE             -0.201368   0.025778  -7.812 5.65e-15 ***\nage                     0.399385   0.010645  37.517  < 2e-16 ***\nany.sports.teamTRUE     0.075070   0.026434   2.840  0.00451 ** \nglbTRUE                 0.366196   0.036621  10.000  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 15862  on 7432  degrees of freedom\nResidual deviance: 14109  on 7427  degrees of freedom\n  (6244 observations deleted due to missingness)\nAIC: 21439\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n:::\n\n\n\n### Example: asthma and smoking\n\nAsthma and smoking in the past month\nThis analysis is based on a past student’s project, evaluating the association between asthma and smoking. The student wanted to evaluate whether males and females have different asso- ciations. They also thought that being older than the typical student in their grade may be a potential confounding factor. Here’s the start of an analysis.\n\nHas a doctor or nurse ever told you that you have asthma?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$asthma=yrbs$Q87==\"Yes\"\ntally(asthma ~ Q87, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       Q87\nasthma   Yes   No Not sure <NA>\n  TRUE  2919    0        0    0\n  FALSE    0 9354      627    0\n  <NA>     0    0        0  777\n```\n:::\n\n```{.r .cell-code}\nyrbs$pastmonth_smoking=yrbs$QN32==1\ntally(pastmonth_smoking ~ Q32, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                 Q32\npastmonth_smoking 0 days 1 or 2 days 3 to 5 days 6 to 9 days 10 to 19 days\n            TRUE       0         327         114          55            71\n            FALSE  11591           0           0           0             0\n            <NA>       0           0           0           0             0\n                 Q32\npastmonth_smoking 20 to 29 days All 30 days  <NA>\n            TRUE             28         131     0\n            FALSE             0           0     0\n            <NA>              0           0  1360\n```\n:::\n\n```{.r .cell-code}\ntally(asthma ~ pastmonth_smoking, data=yrbs, useNA=\"no\", margins=T, format=\"percent\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       pastmonth_smoking\nasthma       TRUE     FALSE\n  TRUE   23.28358  22.23031\n  FALSE  76.71642  77.76969\n  Total 100.00000 100.00000\n```\n:::\n\n```{.r .cell-code}\nchisq.test(tally(asthma ~ pastmonth_smoking, data=yrbs))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's Chi-squared test\n\ndata:  tally(asthma ~ pastmonth_smoking, data = yrbs)\nX-squared = 49.704, df = 4, p-value = 4.164e-10\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1=glm(pastmonth_smoking ~ asthma, data=yrbs, family=binomial)\ndisplay(model1, detail=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nglm(formula = pastmonth_smoking ~ asthma, family = binomial, \n    data = yrbs)\n            coef.est coef.se z value Pr(>|z|)\n(Intercept)  -2.81     0.05  -61.91    0.00  \nasthmaTRUE    0.06     0.09    0.64    0.52  \n---\n  n = 11664, k = 2\n  residual deviance = 5128.7, null deviance = 5129.1 (difference = 0.4)\n```\n:::\n\n```{.r .cell-code}\ncbind(exp(coef(model1)),exp(confint(model1)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                            2.5 %    97.5 %\n(Intercept) 0.06011696 0.05493165 0.0656376\nasthmaTRUE  1.06176008 0.88020795 1.2739006\n```\n:::\n\n```{.r .cell-code}\nmodel2=glm(pastmonth_smoking ~ asthma  + female +age + appropriate.age.for.grade, data=yrbs, family=binomial)\ndisplay(model2, detail=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nglm(formula = pastmonth_smoking ~ asthma + female + age + appropriate.age.for.grade, \n    family = binomial, data = yrbs)\n                              coef.est coef.se z value Pr(>|z|)\n(Intercept)                    -6.48     0.62  -10.48    0.00  \nasthmaTRUE                      0.05     0.10    0.51    0.61  \nfemaleTRUE                     -0.36     0.08   -4.38    0.00  \nage                             0.26     0.03    7.56    0.00  \nappropriate.age.for.gradeTRUE  -0.43     0.18   -2.43    0.02  \n---\n  n = 11508, k = 5\n  residual deviance = 4852.6, null deviance = 4947.7 (difference = 95.1)\n```\n:::\n\n```{.r .cell-code}\ncbind(exp(coef(model2)),exp(confint(model2)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                                                 2.5 %      97.5 %\n(Intercept)                   0.001526682 0.0004512483 0.005104352\nasthmaTRUE                    1.050394219 0.8656139433 1.267371207\nfemaleTRUE                    0.696714307 0.5922142934 0.818723249\nage                           1.298936427 1.2140637435 1.390404241\nappropriate.age.for.gradeTRUE 0.652620488 0.4678269198 0.933971235\n```\n:::\n:::\n\n\n\n1. How do you interpret the bivariate results? Which direction would you report? \n\n2. How would you report and interpret the crude odds ratio?\n\n3. How would you report and interpret the adjusted odds ratio?\n\n4. What information would you put into a table of the logistic regression results?\n\n\n\n### Example: suicidal ideation and grades in school\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$suicidal.ideation=yrbs$Q26==\"Yes\"\ntally(suicidal.ideation ~ Q26, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                 Q26\nsuicidal.ideation   Yes    No  <NA>\n            TRUE   2633     0     0\n            FALSE     0 10804     0\n            <NA>      0     0   240\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyrbs$grades=yrbs$Q89\ntally(grades ~ Q89, data=yrbs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                      Q89\ngrades                 Mostly A's Mostly B's Mostly C's Mostly D's Mostly F's\n  Mostly A's                 5130          0          0          0          0\n  Mostly B's                    0       4655          0          0          0\n  Mostly C's                    0          0       2068          0          0\n  Mostly D's                    0          0          0        435          0\n  Mostly F's                    0          0          0          0        174\n  None of these grades          0          0          0          0          0\n  Not sure                      0          0          0          0          0\n  <NA>                          0          0          0          0          0\n                      Q89\ngrades                 None of these grades Not sure <NA>\n  Mostly A's                              0        0    0\n  Mostly B's                              0        0    0\n  Mostly C's                              0        0    0\n  Mostly D's                              0        0    0\n  Mostly F's                              0        0    0\n  None of these grades                  102        0    0\n  Not sure                                0      447    0\n  <NA>                                    0        0  666\n```\n:::\n:::\n\nis.na(yrbs$grades) = yrbs$Q89==\"None of these grades\"\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntally(suicidal.ideation ~ grades, data=yrbs, format=\"percent\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                 grades\nsuicidal.ideation Mostly A's Mostly B's Mostly C's Mostly D's Mostly F's\n            TRUE   15.828460  20.107411  22.147002  30.344828  39.655172\n            FALSE  83.099415  78.625134  75.628627  65.057471  54.022989\n            <NA>    1.072125   1.267454   2.224371   4.597701   6.321839\n                 grades\nsuicidal.ideation None of these grades  Not sure      <NA>\n            TRUE             17.647059 23.042506 15.765766\n            FALSE            80.392157 72.483221 80.180180\n            <NA>              1.960784  4.474273  4.054054\n```\n:::\n\n```{.r .cell-code}\nplot(tally(suicidal.ideation ~ grades, data=yrbs, format=\"percent\")[1,],\n        type=\"b\", ylab=\"Percent with suicidal ideation\", ylim=c(0,100),\n        axes=F, xlab=\"Grades in school\")\naxis(2)\naxis(1, at=1:8, labels=c(\"As\", \"Bs\", \"Cs\", \"Ds\", \"Fs\", \"None\", \"Unsure\", \"Missing\"))\n```\n\n::: {.cell-output-display}\n![](chapt11_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1=glm(suicidal.ideation ~ grades, data=yrbs, family=binomial)\ndisplay(model1, detail=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nglm(formula = suicidal.ideation ~ grades, family = binomial, \n    data = yrbs)\n                           coef.est coef.se z value Pr(>|z|)\n(Intercept)                 -1.66     0.04  -43.31    0.00  \ngradesMostly B's             0.29     0.05    5.56    0.00  \ngradesMostly C's             0.43     0.07    6.57    0.00  \ngradesMostly D's             0.90     0.11    7.99    0.00  \ngradesMostly F's             1.35     0.16    8.27    0.00  \ngradesNone of these grades   0.14     0.26    0.54    0.59  \ngradesNot sure               0.51     0.12    4.29    0.00  \n---\n  n = 12798, k = 7\n  residual deviance = 12579.5, null deviance = 12720.2 (difference = 140.7)\n```\n:::\n\n```{.r .cell-code}\ncbind(exp(coef(model1)),exp(confint(model1)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                                         2.5 %    97.5 %\n(Intercept)                0.1904762 0.1765901 0.2051917\ngradesMostly B's           1.3426230 1.2102757 1.4897116\ngradesMostly C's           1.5374041 1.3515868 1.7472525\ngradesMostly D's           2.4487633 1.9608995 3.0444650\ngradesMostly F's           3.8537234 2.7912908 5.2960478\ngradesNone of these grades 1.1524390 0.6674814 1.8838241\ngradesNot sure             1.6689815 1.3154428 2.1017143\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel2=glm(suicidal.ideation ~ grades + female + age+ appropriate.age.for.grade, data=yrbs, family=binomial)\ndisplay(model2, detail=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nglm(formula = suicidal.ideation ~ grades + female + age + appropriate.age.for.grade, \n    family = binomial, data = yrbs)\n                              coef.est coef.se z value Pr(>|z|)\n(Intercept)                   -1.84     0.35   -5.31    0.00   \ngradesMostly B's               0.37     0.05    6.77    0.00   \ngradesMostly C's               0.59     0.07    8.72    0.00   \ngradesMostly D's               1.12     0.12    9.60    0.00   \ngradesMostly F's               1.55     0.17    8.97    0.00   \ngradesNone of these grades     0.22     0.27    0.80    0.42   \ngradesNot sure                 0.61     0.12    4.91    0.00   \nfemaleTRUE                     0.82     0.05   17.07    0.00   \nage                           -0.02     0.02   -1.12    0.26   \nappropriate.age.for.gradeTRUE -0.02     0.12   -0.18    0.86   \n---\n  n = 12620, k = 10\n  residual deviance = 12037.4, null deviance = 12479.0 (difference = 441.5)\n```\n:::\n\n```{.r .cell-code}\ncbind(exp(coef(model2)),exp(confint(model2)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWaiting for profiling to be done...\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                                             2.5 %    97.5 %\n(Intercept)                   0.1581005 0.07991345 0.3121621\ngradesMostly B's              1.4441552 1.29852010 1.6064646\ngradesMostly C's              1.8063832 1.58092905 2.0624705\ngradesMostly D's              3.0648026 2.43263882 3.8452151\ngradesMostly F's              4.7252419 3.35433489 6.6221255\ngradesNone of these grades    1.2456981 0.70576743 2.0777164\ngradesNot sure                1.8403320 1.43659949 2.3397027\nfemaleTRUE                    2.2726675 2.06895397 2.4981077\nage                           0.9789436 0.94324871 1.0159705\nappropriate.age.for.gradeTRUE 0.9779215 0.76959328 1.2544318\n```\n:::\n:::\n\n\n\n1. How do you report the bivariate results?\n2. How would you report and interpret the crude odds ratio(s)?\n3. How would you report and interpret the adjusted odds ratio(s)?\n4. What information would you put into a table of the logistic regression results?\n\n\nFor a visual data display (not necessary for the project), you can display the multivariate results visually as adjusted odds ratios with or without confidence intervals. Andrew Gelman calls the data display “the secret weapon.”\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(exp(coef(model2))[2:5], ylab=\"OR\", type=\"b\", axes=F, xlab=\"Grades\",\n        ylim=c(1, 6))\nabline(h=1, lty=2)\naxis(2)\naxis(1, at=1:4, labels=c(\"Mostly Bs\", \"Mostly Cs\", \"Mostly Ds\", \"Mostly Fs\"))\n```\n\n::: {.cell-output-display}\n![](chapt11_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n\n\nTo show the confidence intervals, we need another library, and we put the confidence intervals into a new variable to save on computational time. It may be helpful context to tell the viewer how many participants are in each category. The symbol\nn tells R to insert a new line.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gplots)\nci=exp(confint(model2))\nplotCI(exp(coef(model2))[2:5], li=ci[2:5,1], ui=ci[2:5,2], ylab=\"OR\", type=\"b\",\n        axes=F, xlab=\"Grades\", ylim=c(1, 7), pch=20, gap=0)\nabline(h=1, lty=2)\naxis(2)\naxis(1, at=1:4, labels=c(\"Mostly Bs\\n(n=5660)\", \"Mostly Cs\\n(n=3031)\",\n\"Mostly Ds\\n(n=563)\", \"Mostly Fs\\n(n=245)\"), tick=F)\n```\n\n::: {.cell-output-display}\n![](chapt11_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n\nHow do you interpret these findings? Is it more likely that poor grades cause suicidal ideation, that suicidal ideation causes poor grades, or that a third variable is responsible?\n",
    "supporting": [
      "chapt11_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}